---
interface Props {
    defaultTheme?: "light" | "dark" | "system";
}

const { defaultTheme = "system" } = Astro.props;
---

<button
    class="theme-toggle"
    aria-label="Toggle dark mode"
    data-default-theme={defaultTheme}
>
    <svg
        class="icon-moon"
        width="18"
        height="18"
        viewBox="0 0 18 18"
        fill="none"
        stroke="currentColor"
        stroke-width="1.6"
        stroke-linecap="round"
        stroke-linejoin="round"
    >
        <path d="M15.5 9.37A7 7 0 1 1 8.63 2.5a5.5 5.5 0 0 0 6.87 6.87Z"></path>
    </svg>
    <svg
        class="icon-sun"
        width="18"
        height="18"
        viewBox="0 0 18 18"
        fill="none"
        stroke="currentColor"
        stroke-width="1.6"
        stroke-linecap="round"
        stroke-linejoin="round"
    >
        <circle cx="9" cy="9" r="3.5"></circle>
        <line x1="9" y1="1" x2="9" y2="3"></line>
        <line x1="9" y1="15" x2="9" y2="17"></line>
        <line x1="1" y1="9" x2="3" y2="9"></line>
        <line x1="15" y1="9" x2="17" y2="9"></line>
        <line x1="3.34" y1="3.34" x2="4.75" y2="4.75"></line>
        <line x1="13.25" y1="13.25" x2="14.66" y2="14.66"></line>
        <line x1="3.34" y1="14.66" x2="4.75" y2="13.25"></line>
        <line x1="13.25" y1="4.75" x2="14.66" y2="3.34"></line>
    </svg>
</button>

<script>
    const btn = document.querySelector<HTMLButtonElement>(".theme-toggle")!;
    const defaultTheme = btn.dataset.defaultTheme || "system";

    function getTheme(): string {
        if (
            typeof localStorage !== "undefined" &&
            localStorage.getItem("theme")
        ) {
            return localStorage.getItem("theme")!;
        }
        if (defaultTheme === "system") {
            return window.matchMedia("(prefers-color-scheme: dark)").matches
                ? "dark"
                : "light";
        }
        return defaultTheme;
    }

    function setTheme(theme: string) {
        document.documentElement.setAttribute("data-theme", theme);
        localStorage.setItem("theme", theme);
    }

    setTheme(getTheme());

    btn.addEventListener("click", () => {
        const current = document.documentElement.getAttribute("data-theme");
        setTheme(current === "dark" ? "light" : "dark");
    });
</script>
